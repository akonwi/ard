extern fn sleep(ms: Int) Void = "Sleep"

struct Fiber {
  // raw WaitGroup
  wg: Dynamic
}

private extern fn wait_for(wg: Dynamic) Void = "WaitFor"

impl Fiber {
  fn join() {
    wait_for(@wg)
  }
}

// returns WaitGroup
private extern fn _go(do: fn() Void) Dynamic = "StartGoRoutine"

fn start(do: fn() Void) Fiber {
  let wg = _go(do)
  Fiber{ wg: wg }
}
