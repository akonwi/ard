extern fn sleep(ms: Int) Void = "Sleep"
private extern fn wait_for(wg: Dynamic) Void = "WaitFor"

struct Fiber {
  // pointer to *WaitGroup
  wg: Dynamic,
  // stores the return value of the function run concurrently
  result: $T,
}

impl Fiber {
  fn join() {
    wait_for(self.wg)
  }

  fn get() $T {
    self.join()
    self.result
  }
}

fn start(do: fn() Void) Fiber {
  panic("Unreachable: async::start() is part of the compiler.")
}

fn eval(do: fn() $T) Fiber {
  panic("Unreachable: async::eval() is part of the compiler.")
}

extern fn join(fibers: [Fiber]) Void = "Join"
